<!DOCTYPE html>
<html>
  <head>
    <title>Real time attendance reports</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: #f9fafb;
        margin: 0;
        padding: 0;
      }
      h1 {
        text-align: center;
        margin-top: 24px;
        color: #333;
      }
      .global-search {
        display: flex;
        justify-content: center;
        margin: 16px auto 24px auto;
        max-width: 500px;
        position: relative;
      }
      .global-search input {
        width: 100%;
        padding: 10px 14px;
        font-size: 1em;
        border: 1px solid #ccc;
        border-radius: 6px;
      }
      .autocomplete-list {
        position: absolute;
        top: 42px;
        left: 0;
        width: 100%;
        background: #fff;
        border: 1px solid #ccc;
        border-radius: 6px;
        max-height: 180px;
        overflow-y: auto;
        z-index: 1000;
      }
      .autocomplete-item {
        padding: 8px 12px;
        cursor: pointer;
      }
      .autocomplete-item:hover {
        background: #f0f0f0;
      }
      .region-section {
        background: #ffffff;
        margin: 24px auto 32px auto;
        padding: 0 32px;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        max-width: 900px;
      }
      .region-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        padding: 18px 0;
      }
      .region-title {
        color: #4a4a4a;
        font-size: 1.4em;
        margin: 0;
      }
      .toggle-btn {
        font-size: 1.4em;
        background: none;
        border: none;
        color: #4a4a4a;
        cursor: pointer;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        transition: background 0.2s;
      }
      .toggle-btn:hover {
        background: #f0f0f0;
      }
      .region-content {
        display: none;
        padding-bottom: 24px;
      }
      .filters {
        margin-bottom: 16px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .filters input {
        padding: 8px 12px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 1em;
        background: #f9fafb;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 8px;
        background: #fff;
      }
      th,
      td {
        padding: 10px;
        border-bottom: 1px solid #eaeaea;
        text-align: left;
      }
      th {
        background: #f3f4f6;
        color: #333;
        cursor: pointer;
        user-select: none;
      }
      th.sort-asc::after {
        content: " ▲";
      }
      th.sort-desc::after {
        content: " ▼";
      }
      tr:nth-child(even) {
        background: #f8f9fa;
      }
      tr:nth-child(odd) {
        background: #fff;
      }
      tr:hover td {
        background: #eef2f7;
      }
      .report-link {
        color: #0077cc;
        text-decoration: none;
        font-weight: 500;
      }
      .report-link:hover {
        text-decoration: underline;
      }
      @media (max-width: 700px) {
        .region-section {
          padding: 12px 4px;
        }
        th,
        td {
          padding: 8px 4px;
          font-size: 0.95em;
        }
        .region-title {
          font-size: 1.2em;
        }
      }
    </style>
  </head>
  <body>
    <h1>Real time attendance reports</h1>
    <div class="global-search">
      <input
        type="text"
        id="globalFilter"
        placeholder="Search site or country across all regions..."
      />
      <div
        id="autocomplete"
        class="autocomplete-list"
        style="display: none"
      ></div>
    </div>
    <div id="regions-container"></div>
    <script>
      const siteData = [
        {
          region: "APAC",
          country: "PHILIPPINES",
          site: "Manila, Corporate Center",
        },
        { region: "APAC", country: "PHILIPPINES", site: "Manila, EcoTower" },
        {
          region: "APAC",
          country: "MALAYSIA",
          site: "Kuala Lumpur, Centrepoint South",
        },
        { region: "APAC", country: "INDONESIA", site: "Jakarta, Wisma GKBI" },
        { region: "APAC", country: "SINGAPORE", site: "Suntec Tower Two" },
        {
          region: "APAC",
          country: "AUSTRALIA",
          site: "Melbourne, 575 Bourke St",
        },
        {
          region: "APAC",
          country: "THAILAND",
          site: "Bangkok, Fortune Towers",
        },
        { region: "APAC", country: "INDONESIA", site: "Jakarta, Cyber 2" },
        { region: "APAC", country: "PHILIPPINES", site: "Manila, NEX Tower" },
        { region: "APAC", country: "TAIWAN", site: "Taipei, TPKA" },
        {
          region: "APAC",
          country: "INDONESIA",
          site: "Jakarta, Telkom Landmark",
        },
        {
          region: "CALA",
          country: "MEXICO",
          site: "Guadalajara, Corporativo Galerias",
        },
        { region: "CALA", country: "BRAZIL", site: "Sao Carlos, ParqTec" },
        {
          region: "CALA",
          country: "BRAZIL",
          site: "Sao Paulo, Bandeira Paulista",
        },
        {
          region: "CALA",
          country: "MEXICO",
          site: "Mexico City, Ejercito Nacional",
        },
        { region: "CALA", country: "CHILE", site: "Santiago, El Golf" },
        { region: "EMEA", country: "CYPRUS", site: "Limassol, D.Nicolaou" },
        {
          region: "EMEA",
          country: "CZECH REPUBLIC",
          site: "Prague, Profinit 8",
        },
        { region: "EMEA", country: "BELGIUM", site: "Antwerpen, Veldkant" },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "TX, Plano, The Tennyson",
        },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "GA, Alpharetta-RainWater",
        },
        {
          region: "N. AMERICA",
          country: "CANADA",
          site: "Toronto, 111 Richmond St",
        },
        { region: "N. AMERICA", country: "USA", site: "Champaign" },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "MO, St. Louis, Maryville Centre",
        },
        {
          region: "N. AMERICA",
          country: "CANADA",
          site: "Mississauga, Milverton",
        },
        {
          region: "N. AMERICA",
          country: "CANADA",
          site: "Montreal, 2351 Alfred Nobel",
        },
        { region: "N. AMERICA", country: "USA", site: "VA, Herndon" },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "NJ, Mt. Laurel, Briggs Rd.",
        },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "PA, Philadelphia, Two Logan Square",
        },
        {
          region: "N. AMERICA",
          country: "CANADA",
          site: "Ottawa, Bridgewater HQ",
        },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "KS, Overland Park, Sprint Pkwy",
        },
        { region: "N. AMERICA", country: "USA", site: "NJ, Jersey City" },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "IL, Chicago, 8420 W Bryn Mawr",
        },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "TX, Austin, 515 Congress Avenue",
        },
      ];

      const reportLinks = [
        {
          match: (item) => item.country === "PHILIPPINES",
          url: "https://tabi/#/site/GlobalServices/views/LiveAttendanceDashboard/MISTPhilippines?:iid=1",
          label: "Live Attendance Dashboard",
        },
        {
          match: (item) => item.site === "Guadalajara, Corporativo Galerias",
          url: "https://tabi/#/site/GlobalServices/views/LiveAttendanceDashboard/LiveGuadalajaraCorporativoGaleriasAttendance?:iid=1",
          label: "Live Attendance Dashboard",
        },
        {
          match: (item) => item.site === "TX, Plano, The Tennyson",
          url: "https://tabi/#/site/GlobalServices/views/LiveAttendanceDashboard/LivePlanoTheTennysonAttendance?:iid=1",
          label: "Live Attendance Dashboard",
        },
      ];

      const regions = {};
      siteData.forEach((item) => {
        if (!regions[item.region]) regions[item.region] = [];
        regions[item.region].push(item);
      });

      const container = document.getElementById("regions-container");
      Object.keys(regions).forEach((region) => {
        const section = document.createElement("div");
        section.className = "region-section";

        const headerDiv = document.createElement("div");
        headerDiv.className = "region-header";

        const title = document.createElement("div");
        title.className = "region-title";
        title.textContent = region;

        const toggleBtn = document.createElement("button");
        toggleBtn.className = "toggle-btn";
        toggleBtn.innerHTML = "+";

        headerDiv.appendChild(title);
        headerDiv.appendChild(toggleBtn);
        section.appendChild(headerDiv);

        const contentDiv = document.createElement("div");
        contentDiv.className = "region-content";

        const filtersDiv = document.createElement("div");
        filtersDiv.className = "filters";
        filtersDiv.innerHTML = `
                <input type="text" placeholder="Search Country" class="country-filter">
                <input type="text" placeholder="Search Site Name" class="site-filter">
            `;
        contentDiv.appendChild(filtersDiv);

        const table = document.createElement("table");
        table.innerHTML = `
                <thead>
                    <tr>
                        <th data-column="country">Country</th>
                        <th data-column="site">Site Name</th>
                        <th data-column="report">Report</th>
                    </tr>
                </thead>
                <tbody>
                    ${regions[region]
                      .map((item) => {
                        const link = reportLinks.find((link) =>
                          link.match(item)
                        );
                        return `
                        <tr>
                            <td>${item.country}</td>
                            <td>${item.site}</td>
                            <td>
                                ${
                                  link
                                    ? `<a href="${link.url}" class="report-link" target="_blank">${link.label}</a>`
                                    : ""
                                }
                            </td>
                        </tr>
                        `;
                      })
                      .join("")}
                </tbody>
            `;
        contentDiv.appendChild(table);
        section.appendChild(contentDiv);
        container.appendChild(section);

        toggleBtn.addEventListener("click", () => {
          const isOpen = contentDiv.style.display === "block";
          contentDiv.style.display = isOpen ? "none" : "block";
          toggleBtn.innerHTML = isOpen ? "+" : "–";
        });

        const countryInput = filtersDiv.querySelector(".country-filter");
        const siteInput = filtersDiv.querySelector(".site-filter");
        const rows = table.querySelectorAll("tbody tr");

        function filterRows() {
          const countryVal = countryInput.value.toLowerCase();
          const siteVal = siteInput.value.toLowerCase();
          rows.forEach((row) => {
            const country = row.cells[0].textContent.toLowerCase();
            const site = row.cells[1].textContent.toLowerCase();
            row.style.display =
              (country.includes(countryVal) || !countryVal) &&
              (site.includes(siteVal) || !siteVal)
                ? ""
                : "none";
          });
        }
        countryInput.addEventListener("input", filterRows);
        siteInput.addEventListener("input", filterRows);

        const headers = table.querySelectorAll("th");
        headers.forEach((header, idx) => {
          header.addEventListener("click", () => {
            const isAsc = header.classList.contains("sort-asc");
            headers.forEach((h) => h.classList.remove("sort-asc", "sort-desc"));
            header.classList.toggle("sort-asc", !isAsc);
            header.classList.toggle("sort-desc", isAsc);

            const rowsArr = Array.from(table.querySelectorAll("tbody tr"));
            rowsArr.sort((a, b) => {
              const aText = a.cells[idx].textContent.trim().toLowerCase();
              const bText = b.cells[idx].textContent.trim().toLowerCase();
              return isAsc
                ? bText.localeCompare(aText)
                : aText.localeCompare(bText);
            });
            rowsArr.forEach((row) =>
              table.querySelector("tbody").appendChild(row)
            );
          });
        });
      });

      // Global search with collapse + autocomplete
      const globalFilter = document.getElementById("globalFilter");
      const autocompleteBox = document.getElementById("autocomplete");
      const allRows = document.querySelectorAll("tbody tr");

      globalFilter.addEventListener("input", () => {
        const val = globalFilter.value.toLowerCase();
        const suggestions = [];

        document.querySelectorAll(".region-section").forEach((section) => {
          const rows = section.querySelectorAll("tbody tr");
          let regionHasMatch = false;
          rows.forEach((row) => {
            const country = row.cells[0].textContent.toLowerCase();
            const site = row.cells[1].textContent.toLowerCase();
            const match = country.includes(val) || site.includes(val);
            row.style.display = match || !val ? "" : "none";
            if (match) {
              regionHasMatch = true;
              suggestions.push(
                row.cells[0].textContent,
                row.cells[1].textContent
              );
            }
          });
          section.style.display = regionHasMatch || !val ? "" : "none";
        });

        // Autocomplete suggestions
        if (val && suggestions.length > 0) {
          autocompleteBox.innerHTML = [...new Set(suggestions)]
            .slice(0, 10)
            .map((s) => `<div class="autocomplete-item">${s}</div>`)
            .join("");
          autocompleteBox.style.display = "block";
        } else {
          autocompleteBox.style.display = "none";
        }
      });

      autocompleteBox.addEventListener("click", (e) => {
        if (e.target.classList.contains("autocomplete-item")) {
          globalFilter.value = e.target.textContent;
          autocompleteBox.style.display = "none";
          globalFilter.dispatchEvent(new Event("input"));
        }
      });
    </script>
  </body>
</html>
