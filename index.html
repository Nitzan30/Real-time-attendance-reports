<!DOCTYPE html>
<html>
  <head>
    <title>Real time attendance reports</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: #f6f8fa;
        margin: 0;
        padding: 0;
      }
      h1 {
        text-align: center;
        margin-top: 32px;
        color: #22223b;
      }
      .region-section {
        background: #fff;
        margin: 32px auto 40px auto;
        padding: 0 32px 0 32px;
        border-radius: 16px;
        box-shadow: 0 4px 24px rgba(34, 34, 59, 0.08);
        max-width: 900px;
      }
      .region-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        padding: 24px 0 24px 0;
      }
      .region-title {
        color: #3a5a40;
        font-size: 1.6em;
        letter-spacing: 1px;
        margin: 0;
      }
      .toggle-btn {
        font-size: 1.5em;
        background: none;
        border: none;
        color: #3a5a40;
        cursor: pointer;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        transition: background 0.2s;
      }
      .toggle-btn:hover {
        background: #e9ecef;
      }
      .region-content {
        display: none;
        padding-bottom: 32px;
      }
      .filters {
        margin-bottom: 18px;
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }
      .filters input {
        padding: 8px 12px;
        border: 1px solid #b7b7b7;
        border-radius: 6px;
        font-size: 1em;
        background: #f6f8fa;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 8px;
        background: #fff;
      }
      th,
      td {
        padding: 12px 10px;
        border-bottom: 1px solid #e0e0e0;
        text-align: left;
      }
      th {
        background: #e9ecef;
        color: #22223b;
        cursor: pointer;
        user-select: none;
        position: relative;
      }
      th.sort-asc::after {
        content: " ▲";
      }
      th.sort-desc::after {
        content: " ▼";
      }
      tr:hover td {
        background: #f1faee;
      }
      .report-link {
        color: #1976d2;
        text-decoration: none;
        font-weight: 500;
      }
      .report-link:hover {
        text-decoration: underline;
      }
      @media (max-width: 700px) {
        .region-section {
          padding: 12px 4px;
        }
        th,
        td {
          padding: 8px 4px;
          font-size: 0.95em;
        }
        .region-title {
          font-size: 1.2em;
        }
      }
    </style>
  </head>
  <body>
    <h1>Real time attendance reports</h1>
    <div id="regions-container"></div>
    <script>
      // Data extracted from your Excel file
      const siteData = [
        {
          region: "APAC",
          country: "PHILIPPINES",
          site: "Manila, Corporate Center",
        },
        { region: "APAC", country: "PHILIPPINES", site: "Manila, EcoTower" },
        {
          region: "APAC",
          country: "MALAYSIA",
          site: "Kuala Lumpur, Centrepoint South",
        },
        { region: "APAC", country: "INDONESIA", site: "Jakarta, Wisma GKBI" },
        { region: "APAC", country: "SINGAPORE", site: "Suntec Tower Two" },
        {
          region: "APAC",
          country: "AUSTRALIA",
          site: "Melbourne, 575 Bourke St",
        },
        {
          region: "APAC",
          country: "THAILAND",
          site: "Bangkok, Fortune Towers",
        },
        { region: "APAC", country: "INDONESIA", site: "Jakarta, Cyber 2" },
        { region: "APAC", country: "PHILIPPINES", site: "Manila, NEX Tower" },
        { region: "APAC", country: "TAIWAN", site: "Taipei, TPKA" },
        {
          region: "APAC",
          country: "INDONESIA",
          site: "Jakarta, Telkom Landmark",
        },
        {
          region: "CALA",
          country: "MEXICO",
          site: "Guadalajara, Corporativo Galerias",
        },
        { region: "CALA", country: "BRAZIL", site: "Sao Carlos, ParqTec" },
        {
          region: "CALA",
          country: "BRAZIL",
          site: "Sao Paulo, Bandeira Paulista",
        },
        {
          region: "CALA",
          country: "MEXICO",
          site: "Mexico City, Ejercito Nacional",
        },
        { region: "CALA", country: "CHILE", site: "Santiago, El Golf" },
        { region: "EMEA", country: "CYPRUS", site: "Limassol, D.Nicolaou" },
        {
          region: "EMEA",
          country: "CZECH REPUBLIC",
          site: "Prague, Profinit 8",
        },
        { region: "EMEA", country: "BELGIUM", site: "Antwerpen, Veldkant" },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "TX, Plano, The Tennyson",
        },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "GA, Alpharetta-RainWater",
        },
        {
          region: "N. AMERICA",
          country: "CANADA",
          site: "Toronto, 111 Richmond St",
        },
        { region: "N. AMERICA", country: "USA", site: "Champaign" },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "MO, St. Louis, Maryville Centre",
        },
        {
          region: "N. AMERICA",
          country: "CANADA",
          site: "Mississauga, Milverton",
        },
        {
          region: "N. AMERICA",
          country: "CANADA",
          site: "Montreal, 2351 Alfred Nobel",
        },
        { region: "N. AMERICA", country: "USA", site: "VA, Herndon" },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "NJ, Mt. Laurel, Briggs Rd.",
        },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "PA, Philadelphia, Two Logan Square",
        },
        {
          region: "N. AMERICA",
          country: "CANADA",
          site: "Ottawa, Bridgewater HQ",
        },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "KS, Overland Park, Sprint Pkwy",
        },
        { region: "N. AMERICA", country: "USA", site: "NJ, Jersey City" },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "IL, Chicago, 8420 W Bryn Mawr",
        },
        { region: "N. AMERICA", country: "USA", site: "Champaign" },
        {
          region: "N. AMERICA",
          country: "USA",
          site: "TX, Austin, 515 Congress Avenue",
        },
      ];

      // Report links mapping
      const reportLinks = [
        {
          match: (item) => item.country === "PHILIPPINES",
          url: "https://tabi/#/site/GlobalServices/views/LiveAttendanceDashboard/MISTPhilippines?:iid=1",
          label: "Live Attendance Dashboard",
        },
        {
          match: (item) => item.site === "Guadalajara, Corporativo Galerias",
          url: "https://tabi/#/site/GlobalServices/views/LiveAttendanceDashboard/LiveGuadalajaraCorporativoGaleriasAttendance?:iid=1",
          label: "Live Attendance Dashboard",
        },
        {
          match: (item) => item.site === "TX, Plano, The Tennyson",
          url: "https://tabi/#/site/GlobalServices/views/LiveAttendanceDashboard/LivePlanoTheTennysonAttendance?:iid=1",
          label: "Live Attendance Dashboard",
        },
      ];

      // Color palette for countries (extend as needed)
      const countryColors = [
        "#ffe5e5",
        "#e5f7ff",
        "#e5ffe5",
        "#fffbe5",
        "#f3e5ff",
        "#e5e9ff",
        "#ffe5f7",
        "#e5fff7",
        "#fbe5ff",
        "#e5fff3",
      ];
      const countryColorMap = {};
      let colorIdx = 0;

      // Assign a color to each country
      siteData.forEach((item) => {
        if (!countryColorMap[item.country]) {
          countryColorMap[item.country] =
            countryColors[colorIdx % countryColors.length];
          colorIdx++;
        }
      });

      // Group data by region
      const regions = {};
      siteData.forEach((item) => {
        if (!regions[item.region]) regions[item.region] = [];
        regions[item.region].push(item);
      });

      // Render tables per region
      const container = document.getElementById("regions-container");
      Object.keys(regions).forEach((region) => {
        const section = document.createElement("div");
        section.className = "region-section";

        // Region header with toggle button
        const headerDiv = document.createElement("div");
        headerDiv.className = "region-header";

        const title = document.createElement("div");
        title.className = "region-title";
        title.textContent = region;

        const toggleBtn = document.createElement("button");
        toggleBtn.className = "toggle-btn";
        toggleBtn.innerHTML = "+";

        headerDiv.appendChild(title);
        headerDiv.appendChild(toggleBtn);
        section.appendChild(headerDiv);

        // Region content (hidden by default)
        const contentDiv = document.createElement("div");
        contentDiv.className = "region-content";

        // Filters
        const filtersDiv = document.createElement("div");
        filtersDiv.className = "filters";
        filtersDiv.innerHTML = `
                <input type="text" placeholder="Search Country" class="country-filter">
                <input type="text" placeholder="Search Site Name" class="site-filter">
            `;
        contentDiv.appendChild(filtersDiv);

        // Table
        const table = document.createElement("table");
        table.innerHTML = `
                <thead>
                    <tr>
                        <th data-column="country">Country</th>
                        <th data-column="site">Site Name</th>
                        <th data-column="report">Report</th>
                    </tr>
                </thead>
                <tbody>
                    ${regions[region]
                      .map((item) => {
                        // Find matching report link
                        const link = reportLinks.find((link) =>
                          link.match(item)
                        );
                        const countryColor =
                          countryColorMap[item.country] || "#fff";
                        return `
                        <tr style="background:${countryColor}">
                            <td>${item.country}</td>
                            <td>${item.site}</td>
                            <td>
                                ${
                                  link
                                    ? `<a href="${link.url}" class="report-link" target="_blank" rel="noopener noreferrer">${link.label}</a>`
                                    : ""
                                }
                            </td>
                        </tr>
                        `;
                      })
                      .join("")}
                </tbody>
            `;
        contentDiv.appendChild(table);
        section.appendChild(contentDiv);
        container.appendChild(section);

        // Toggle logic
        toggleBtn.addEventListener("click", () => {
          const isOpen = contentDiv.style.display === "block";
          contentDiv.style.display = isOpen ? "none" : "block";
          toggleBtn.innerHTML = isOpen ? "+" : "–";
        });

        // Filtering logic
        const countryInput = filtersDiv.querySelector(".country-filter");
        const siteInput = filtersDiv.querySelector(".site-filter");
        const rows = table.querySelectorAll("tbody tr");

        function filterRows() {
          const countryVal = countryInput.value.toLowerCase();
          const siteVal = siteInput.value.toLowerCase();
          rows.forEach((row) => {
            const country = row.cells[0].textContent.toLowerCase();
            const site = row.cells[1].textContent.toLowerCase();
            if (
              (country.includes(countryVal) || !countryVal) &&
              (site.includes(siteVal) || !siteVal)
            ) {
              row.style.display = "";
            } else {
              row.style.display = "none";
            }
          });
        }
        countryInput.addEventListener("input", filterRows);
        siteInput.addEventListener("input", filterRows);

        // Sorting logic
        const headers = table.querySelectorAll("th");
        headers.forEach((header, idx) => {
          header.addEventListener("click", () => {
            const isAsc = header.classList.contains("sort-asc");
            headers.forEach((h) => h.classList.remove("sort-asc", "sort-desc"));
            header.classList.toggle("sort-asc", !isAsc);
            header.classList.toggle("sort-desc", isAsc);

            const rowsArr = Array.from(table.querySelectorAll("tbody tr"));
            rowsArr.sort((a, b) => {
              const aText = a.cells[idx].textContent.trim().toLowerCase();
              const bText = b.cells[idx].textContent.trim().toLowerCase();
              return isAsc
                ? bText.localeCompare(aText)
                : aText.localeCompare(bText);
            });
            rowsArr.forEach((row) =>
              table.querySelector("tbody").appendChild(row)
            );
          });
        });
      });
    </script>
  </body>
</html>
